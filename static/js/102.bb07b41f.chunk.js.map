{"version":3,"file":"static/js/102.bb07b41f.chunk.js","mappings":"iPAMA,MAAMA,EAAiB,CACrBC,OAAQ,0CACRC,WAAY,+BACZC,UAAW,eACXC,cAAe,mCACfC,kBAAmB,eACnBC,MAAO,6CAGHC,GAAMC,EAAAA,EAAAA,eAAcR,GACpBS,GAAOC,EAAAA,EAAAA,SAAQH,GACfI,GAAKC,EAAAA,EAAAA,cAAaL,GAClBM,GAAYC,EAAAA,EAAAA,cAAaP,IAe/BQ,EAAAA,EAAAA,WAAUF,GAAYG,IACpBC,QAAQC,IAAI,oBAAqBF,GACjCG,MAAM,iBAAiBH,EAAQI,aAAaC,WAAWL,EAAQI,aAAaE,OAAO,I,gLC7BrF,MAuGA,EAvGoBC,KAElB,MAAOC,EAAUC,IAAeC,EAAAA,EAAAA,UAAS,OAClCC,EAAaC,IAAkBF,EAAAA,EAAAA,UAAS,OACxCG,EAAgBC,IAAqBJ,EAAAA,EAAAA,UAAS,eAE9CK,EAAUC,IAAeN,EAAAA,EAAAA,WAAS,IAClCO,EAAeC,IAAoBR,EAAAA,EAAAA,WAAS,IAE5CS,IAAgBC,EAAAA,EAAAA,MAEjBC,EAAUF,EAAaG,IAAI,WAC3BC,EAASJ,EAAaG,IAAI,UAC1BE,GAAWC,EAAAA,EAAAA,OAOjBC,EAAAA,EAAAA,YAAU,KAER,IAAKH,EAEH,YADAC,EAAS,uBAAuBH,KAIlC,MAAMM,GAAWC,EAAAA,EAAAA,KAAIjC,EAAAA,GAAI,SAAU0B,GAE7BQ,GAAcC,EAAAA,EAAAA,YAAWH,GAAWI,IAExC,IAAKA,EAAQC,SAGX,OAFA7B,MAAM,gCACNqB,EAAS,kBAKX,MAAMS,EAAOF,EAAQE,OAEfC,EAAcD,EAAKE,MAAQF,EAAKE,MAAMC,MAAKC,GAAKA,EAAEd,SAAWA,IAAU,KACzEW,GAEFpB,EAAkB,WAAWoB,EAAYI,SAASJ,EAAYK,UAE9D9B,EAAYyB,EAAY1B,UAExBI,EA/BqB,EA+BNsB,EAAY1B,UAEE,IAAzB0B,EAAY1B,UACdU,GAAiB,GAEZH,IACHC,GAAY,GACZb,MAAM,yBAGRe,GAAiB,IAEVD,GAETO,EAAS,YACX,IAIF,MAAO,IAAMK,GAAa,GACzB,CAACR,EAASE,EAAQC,EAAUT,EAAUE,EAnDd,IAyE3B,OACEuB,EAAAA,EAAAA,MAAA,OAAKC,UAAU,eAAcC,SAAA,EAC3BC,EAAAA,EAAAA,KAAA,OAAKC,GAAG,iBAAgBF,SAAE7B,KAC1B8B,EAAAA,EAAAA,KAAA,MAAAD,SAAI,kBACJF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,mBAAkBC,SAAA,EAC/BC,EAAAA,EAAAA,KAAA,MAAAD,SAAKzB,EAAgB,kBAAoB,mBACzC0B,EAAAA,EAAAA,KAAA,OAAKF,UAAU,kBAAiBC,SAAElC,QAEpCgC,EAAAA,EAAAA,MAAA,KAAAE,SAAA,CAAG,wBAAsB/B,EAAY,eACrCgC,EAAAA,EAAAA,KAAA,UAAQC,GAAG,gBAAgBH,UAAU,MAAMI,QA3B5BC,UAEjB,MAAMnB,GAAWC,EAAAA,EAAAA,KAAIjC,EAAAA,GAAI,SAAU0B,GAC7B0B,QAAkBC,EAAAA,EAAAA,QAAOrB,GAC/B,IAAKoB,EAAUf,SAAU,OAGzB,IAAIiB,EADSF,EAAUd,OACCE,MAAMe,QAAOb,GAAKA,EAAEd,SAAWA,IAEvD0B,EAAeA,EAAaE,KAAI,CAACd,EAAGe,KAAK,IAAWf,EAAG7B,SAAU4C,YAE3DC,EAAAA,EAAAA,WAAU1B,EAAU,CAAEQ,MAAOc,IAEnC9C,MAAM,4BACNqB,EAASP,EAAgB,YAAc,uBAAuBI,IAAU,EAaPqB,SAAC,kBAC5D,E","sources":["firebase/firebase-config.js","pages/QueueStatus.js"],"sourcesContent":["// src/firebase/firebase-config.js\r\nimport { initializeApp } from \"https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js\";\r\nimport { getAuth } from \"https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js\";\r\nimport { getFirestore } from \"https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js\";\r\nimport { getMessaging, getToken, onMessage } from \"https://www.gstatic.com/firebasejs/10.11.1/firebase-messaging.js\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyAhBlyXYwfLE1rXPcWRiouJfsp6gIpG894\",\r\n  authDomain: \"smartq-d015b.firebaseapp.com\",\r\n  projectId: \"smartq-d015b\",\r\n  storageBucket: \"smartq-d015b.firebasestorage.app\",\r\n  messagingSenderId: \"452644823738\",\r\n  appId: \"1:452644823738:web:7a133f086ff93200b39883\"\r\n};\r\n\r\nconst app = initializeApp(firebaseConfig);\r\nconst auth = getAuth(app);\r\nconst db = getFirestore(app);\r\nconst messaging = getMessaging(app);\r\n\r\n// Request notification permission if needed\r\nexport async function requestNotificationPermission() {\r\n  try {\r\n    const token = await getToken(messaging, { vapidKey: \"YOUR_VAPID_PUBLIC_KEY\" });\r\n    if (token) {\r\n      console.log(\"Notification Token:\", token);\r\n      return token;\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Notification permission error:\", error);\r\n  }\r\n}\r\n\r\nonMessage(messaging, (payload) => {\r\n  console.log(\"Message received:\", payload);\r\n  alert(`Notification: ${payload.notification.title} - ${payload.notification.body}`);\r\n});\r\n\r\nexport { auth, db, messaging };\r\n","// src/pages/QueueStatus.js\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useSearchParams, useNavigate } from 'react-router-dom';\r\nimport { db } from '../firebase/firebase-config';\r\nimport { doc, onSnapshot, updateDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js';\r\n\r\nconst QueueStatus = () => {\r\n  //State variables for the user’s queue information\r\n  const [position, setPosition] = useState('--');\r\n  const [estWaitTime, setEstWaitTime] = useState('--');\r\n  const [welcomeMessage, setWelcomeMessage] = useState(\"Loading...\");\r\n  //Message to greet user, then show their name/email\r\n  const [notified, setNotified] = useState(false);\r\n  const [isBeingServed, setIsBeingServed] = useState(false);\r\n  //Tracks if the user’s position is 0 (being served)\r\n  const [searchParams] = useSearchParams();\r\n  //Read queueId and userId from the URL query parameters\r\n  const queueId = searchParams.get('queueId');\r\n  const userId = searchParams.get('userId');\r\n  const navigate = useNavigate();\r\n\r\n  // Average service time in minutes per user\r\n  const averageServiceTime = 5;\r\n\r\n\r\n  //useEffect: runs when component mounts or when dependencies change\r\n  useEffect(() => {\r\n    // If userId is missing, send them back to join-queue page\r\n    if (!userId) {\r\n      navigate(`/join-queue?queueId=${queueId}`);\r\n      return;\r\n    }\r\n    // Reference the specific queue document in Firestore\r\n    const queueRef = doc(db, \"queues\", queueId);\r\n    //Listen in real time for updates to this queue document\r\n    const unsubscribe = onSnapshot(queueRef, (docSnap) => {\r\n      //If the queue no longer exists, alert and redirect to InvalidQueue\r\n      if (!docSnap.exists()) {\r\n        alert(\"Queue has been removed.\");\r\n        navigate('/invalid-queue');\r\n        return;\r\n      }\r\n\r\n      // Extract the document data\r\n      const data = docSnap.data();\r\n      // Update current user info from queue\r\n      const currentUser = data.users ? data.users.find(u => u.userId === userId) : null;\r\n      if (currentUser) {\r\n        //Update welcome message with the user’s name and email\r\n        setWelcomeMessage(`Welcome ${currentUser.name} (${currentUser.email})`);\r\n        //Update the user’s position in state\r\n        setPosition(currentUser.position);\r\n        // Calculate estimated wait time based on the user's position\r\n        setEstWaitTime(currentUser.position * averageServiceTime);\r\n        //If the user’s position is 0, they are being served\r\n        if (currentUser.position === 0) {\r\n          setIsBeingServed(true);\r\n          //Show alert only once when they first reach position 0\r\n          if (!notified) {\r\n            setNotified(true);\r\n            alert(\"It's your turn now!\");\r\n          }\r\n        } else { //If position > 0, they are waiting\r\n          setIsBeingServed(false);\r\n        }\r\n      } else if (isBeingServed) {\r\n        //If the user was being served but no longer in the list, send to farewell (thank you)\r\n        navigate('/farewell');\r\n      }\r\n    });\r\n\r\n    //Clean up the Firestore listener when the component unmounts\r\n    return () => unsubscribe();\r\n  }, [queueId, userId, navigate, notified, isBeingServed, averageServiceTime]);\r\n\r\n\r\n  // Handler for “Leave Queue” button\r\n  const leaveQueue = async () => {\r\n    //Reference the queue document and fetch it once\r\n    const queueRef = doc(db, \"queues\", queueId);\r\n    const queueSnap = await getDoc(queueRef);\r\n    if (!queueSnap.exists()) return;\r\n    // Get current users list, filter out this user\r\n    const data = queueSnap.data();\r\n    let updatedUsers = data.users.filter(u => u.userId !== userId);\r\n    // Reassign positions after the user leaves or  Reassign positions in order (0, 1, 2, …)\r\n    updatedUsers = updatedUsers.map((u, index) => ({ ...u, position: index }));\r\n    //Save the updated array back to Firestore\r\n    await updateDoc(queueRef, { users: updatedUsers });\r\n    //Notify the user and redirect appropriately\r\n    alert(\"You have left the queue.\");\r\n    navigate(isBeingServed ? '/farewell' : `/join-queue?queueId=${queueId}`);\r\n  };\r\n\r\n  //Render the UI\r\n  return (\r\n    <div className=\"queue-status\">\r\n      <div id=\"welcomeMessage\">{welcomeMessage}</div>\r\n      <h2>Queue Status</h2>\r\n      <div className=\"position-display\">\r\n        <h2>{isBeingServed ? \"It's your turn!\" : \"Your Position\"}</h2>\r\n        <div className=\"position-number\">{position}</div>\r\n      </div>\r\n      <p>Estimated wait time: {estWaitTime} minutes</p>\r\n      <button id=\"leaveQueueBtn\" className=\"btn\" onClick={leaveQueue}>Leave Queue</button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QueueStatus;\r\n"],"names":["firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","app","initializeApp","auth","getAuth","db","getFirestore","messaging","getMessaging","onMessage","payload","console","log","alert","notification","title","body","QueueStatus","position","setPosition","useState","estWaitTime","setEstWaitTime","welcomeMessage","setWelcomeMessage","notified","setNotified","isBeingServed","setIsBeingServed","searchParams","useSearchParams","queueId","get","userId","navigate","useNavigate","useEffect","queueRef","doc","unsubscribe","onSnapshot","docSnap","exists","data","currentUser","users","find","u","name","email","_jsxs","className","children","_jsx","id","onClick","async","queueSnap","getDoc","updatedUsers","filter","map","index","updateDoc"],"sourceRoot":""}